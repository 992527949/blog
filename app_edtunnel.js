const _0x27ea=['readyState','value','floor','createConnection','write','rawClientData:','handleTCPOutBound\x20connected\x20to\x20','closed','then','addressValue\x20is\x20empty,\x20addressType\x20is\x20','toString','已连接到服务器','readUInt16BE','data','net','error','retry','处理\x20ArrayBuffer\x20出错：','slice','catch','end','log','join','byteLength','handleDNSQuery\x20已连接到服务器','safeCloseWebSocket\x20error','decode','udp\x20','b3e5d302-bdb5-4da9-9ce6-1e0f87878bd0','push','send','random','toLowerCase','arrayBuffer','close','Connection\x20closed'];const _0x5819=function(_0x27ea39,_0x581942){_0x27ea39=_0x27ea39-0x0;let _0x3898ec=_0x27ea[_0x27ea39];return _0x3898ec;};const WebSocket=require('ws');const {Readable}=require('stream');const net=require(_0x5819('0xe'));const wss=new WebSocket['Server']({'port':0x1bb});let userID=_0x5819('0x1c');let proxyIP='64.68.192.'+Math[_0x5819('0x2')](Math[_0x5819('0x1f')]()*0xff);let address='';let portWithRandomLog='';const log=(_0x2eb0e9,_0x5c8fe3)=>{console['log']('['+address+':'+portWithRandomLog+']\x20'+_0x2eb0e9,_0x5c8fe3||'');};wss['on']('connection',_0x4ac34c=>{console[_0x5819('0x15')]('ws\x20connection');_0x4ac34c['once']('message',_0x4deb9b=>{console[_0x5819('0x15')]('on\x20message');let _0xa537cf=_0x4ac34c;let _0x4591d5={'value':null};let _0x3ecf2a=![];const {hasError,message,portRemote=0x1bb,addressRemote='',rawDataIndex,vlessVersion=new Uint8Array([0x0,0x0]),isUDP}=processVlessHeader(_0x4deb9b,userID);address=addressRemote;portWithRandomLog=portRemote+'--'+Math['random']()+'\x20'+(isUDP?_0x5819('0x1b'):'tcp\x20')+'\x20';if(hasError){console['log']('hasError,Connection\x20closed:'+message);_0x4ac34c[_0x5819('0x22')]();return;}if(isUDP){if(portRemote===0x35){_0x3ecf2a=!![];}else{throw new Error('UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053');return;}}const _0x49e380=new Uint8Array([vlessVersion[0x0],0x0]);const _0x57f7b8=_0x4deb9b[_0x5819('0x12')](rawDataIndex);if(_0x3ecf2a){return handleDNSQuery(_0x57f7b8,_0xa537cf,_0x49e380,log);}handleTCPOutBound(_0x4591d5,addressRemote,portRemote,_0x57f7b8,_0xa537cf,_0x49e380,log);});_0x4ac34c['on']('close',()=>{console['log'](_0x5819('0x23'));_0x4ac34c[_0x5819('0x22')]();});});async function handleTCPOutBound(_0x259300,_0x27b307,_0x46c69c,_0x11bacb,_0x4d026c,_0x4653d4,_0x4e93a9){async function _0x30621c(_0x1ecffa,_0x34317d){const _0xa9c132={'host':_0x1ecffa,'port':_0x34317d};const _0x58c79e=net['createConnection'](_0xa9c132,()=>{console[_0x5819('0x15')](_0x5819('0xb'));});_0x259300[_0x5819('0x1')]=_0x58c79e;_0x4e93a9(_0x5819('0x6')+_0x1ecffa+':'+_0x34317d);console['log'](_0x5819('0x5')+_0x11bacb);_0x58c79e[_0x5819('0x4')](_0x11bacb);return _0x58c79e;}async function _0xf83874(){console[_0x5819('0x15')](_0x5819('0x10'));const _0x92fd4d=await _0x30621c(proxyIP||_0x27b307,_0x46c69c);_0x92fd4d[_0x5819('0x7')][_0x5819('0x13')](_0x16d15e=>{console['log']('retry\x20tcpSocket\x20closed\x20error',_0x16d15e);})['finally'](()=>{safeCloseWebSocket(_0x4d026c);});remoteSocketToWS(_0x92fd4d,_0x4d026c,_0x4653d4,null,_0x4e93a9);}const _0x567004=await _0x30621c(_0x27b307,_0x46c69c);remoteSocketToWS(_0x567004,_0x4d026c,_0x4653d4,_0xf83874,_0x4e93a9);}async function remoteSocketToWS(_0x2011ff,_0x54858e,_0x14d967,_0x419746,_0x4eac37){let _0x5e8e1a=0x0;let _0x296d3b=[];let _0x350950=_0x14d967;_0x2011ff['on']('data',_0x6a4ecc=>{if(_0x350950){new Blob([_0x350950,_0x6a4ecc])['arrayBuffer']()[_0x5819('0x8')](_0x57d53f=>{_0x54858e[_0x5819('0x1e')](_0x57d53f);})[_0x5819('0x13')](_0x56bc68=>{console['error']('处理\x20ArrayBuffer\x20出错：',_0x56bc68);});_0x350950=null;}else{_0x54858e[_0x5819('0x1e')](_0x6a4ecc);}});_0x2011ff['on'](_0x5819('0x14'),()=>{console[_0x5819('0x15')]('remoteSocket\x20on\x20end\x20end\x20end');_0x54858e['send'](null);});let _0x54b8b2=![];_0x2011ff['on'](_0x5819('0xf'),()=>{_0x54b8b2=!![];});if(_0x54b8b2&&_0x419746){_0x4eac37(_0x5819('0x10'));_0x419746();}}function processVlessHeader(_0x3f9253,_0x50026e){if(_0x3f9253[_0x5819('0x17')]<0x18){return{'hasError':!![],'message':'invalid\x20data'};}const _0x307033=new Uint8Array(_0x3f9253['slice'](0x0,0x1));let _0x364d7e=![];let _0x2116c8=![];if(stringify(new Uint8Array(_0x3f9253[_0x5819('0x12')](0x1,0x11)))===_0x50026e){console['log'](stringify(new Uint8Array(_0x3f9253['slice'](0x1,0x11))));console['log'](_0x50026e);_0x364d7e=!![];}if(!_0x364d7e){console[_0x5819('0x15')](stringify(new Uint8Array(_0x3f9253['slice'](0x1,0x11))));console[_0x5819('0x15')](_0x50026e);return{'hasError':!![],'message':'invalid\x20user'};}const _0x37a8ca=new Uint8Array(_0x3f9253['slice'](0x11,0x12))[0x0];const _0x38bc79=new Uint8Array(_0x3f9253[_0x5819('0x12')](0x12+_0x37a8ca,0x12+_0x37a8ca+0x1))[0x0];if(_0x38bc79===0x1){}else if(_0x38bc79===0x2){_0x2116c8=!![];}else{return{'hasError':!![],'message':'command\x20'+_0x38bc79+'\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux'};}const _0xf5085e=0x12+_0x37a8ca+0x1;const _0x526c89=_0x3f9253['slice'](_0xf5085e,_0xf5085e+0x2);const _0x160bf4=_0x526c89[_0x5819('0xc')]();let _0x1f57cd=_0xf5085e+0x2;const _0x388efe=new Uint8Array(_0x3f9253['slice'](_0x1f57cd,_0x1f57cd+0x1));const _0x220a4f=_0x388efe[0x0];let _0x1ef4ab=0x0;let _0x3b6480=_0x1f57cd+0x1;let _0x1d3571='';switch(_0x220a4f){case 0x1:_0x1ef4ab=0x4;_0x1d3571=new Uint8Array(_0x3f9253['slice'](_0x3b6480,_0x3b6480+_0x1ef4ab))[_0x5819('0x16')]('.');break;case 0x2:_0x1ef4ab=new Uint8Array(_0x3f9253['slice'](_0x3b6480,_0x3b6480+0x1))[0x0];_0x3b6480+=0x1;_0x1d3571=new TextDecoder()[_0x5819('0x1a')](_0x3f9253[_0x5819('0x12')](_0x3b6480,_0x3b6480+_0x1ef4ab));break;case 0x3:_0x1ef4ab=0x10;const _0x180ba8=new DataView(_0x3f9253['slice'](_0x3b6480,_0x3b6480+_0x1ef4ab));const _0x317700=[];for(let _0x199911=0x0;_0x199911<0x8;_0x199911++){_0x317700[_0x5819('0x1d')](_0x180ba8['getUint16'](_0x199911*0x2)['toString'](0x10));}_0x1d3571=_0x317700['join'](':');break;default:return{'hasError':!![],'message':'invild\x20\x20addressType\x20is\x20'+_0x220a4f};}if(!_0x1d3571){return{'hasError':!![],'message':_0x5819('0x9')+_0x220a4f};}return{'hasError':![],'addressRemote':_0x1d3571,'addressType':_0x220a4f,'portRemote':_0x160bf4,'rawDataIndex':_0x3b6480+_0x1ef4ab,'vlessVersion':_0x307033,'isUDP':_0x2116c8};}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex[_0x5819('0x1d')]((i+0x100)[_0x5819('0xa')](0x10)[_0x5819('0x12')](0x1));}function unsafeStringify(_0x11a1e7,_0x37a926=0x0){return(byteToHex[_0x11a1e7[_0x37a926+0x0]]+byteToHex[_0x11a1e7[_0x37a926+0x1]]+byteToHex[_0x11a1e7[_0x37a926+0x2]]+byteToHex[_0x11a1e7[_0x37a926+0x3]]+'-'+byteToHex[_0x11a1e7[_0x37a926+0x4]]+byteToHex[_0x11a1e7[_0x37a926+0x5]]+'-'+byteToHex[_0x11a1e7[_0x37a926+0x6]]+byteToHex[_0x11a1e7[_0x37a926+0x7]]+'-'+byteToHex[_0x11a1e7[_0x37a926+0x8]]+byteToHex[_0x11a1e7[_0x37a926+0x9]]+'-'+byteToHex[_0x11a1e7[_0x37a926+0xa]]+byteToHex[_0x11a1e7[_0x37a926+0xb]]+byteToHex[_0x11a1e7[_0x37a926+0xc]]+byteToHex[_0x11a1e7[_0x37a926+0xd]]+byteToHex[_0x11a1e7[_0x37a926+0xe]]+byteToHex[_0x11a1e7[_0x37a926+0xf]])[_0x5819('0x20')]();}function stringify(_0x1eb281,_0x14f10f=0x0){const _0x5dc5e2=unsafeStringify(_0x1eb281,_0x14f10f);return _0x5dc5e2;}async function handleDNSQuery(_0x48c7b4,_0x3a4f0f,_0x52a118,_0x2b80fc){try{const _0x1df989='8.8.4.4';const _0x1bcdd6=0x35;let _0x313175=_0x52a118;const _0x547120={'host':_0x1df989,'port':_0x1bcdd6};const _0x205062=net[_0x5819('0x3')](_0x547120,()=>{console[_0x5819('0x15')](_0x5819('0x18'));});_0x2b80fc('connected\x20to\x20'+_0x1df989+':'+_0x1bcdd6);_0x205062[_0x5819('0x4')](_0x48c7b4);_0x205062['on'](_0x5819('0xd'),_0x5f067c=>{if(_0x3a4f0f[_0x5819('0x0')]===WS_READY_STATE_OPEN){if(_0x313175){new Blob([_0x313175,_0x5f067c])[_0x5819('0x21')]()[_0x5819('0x8')](_0x2b5144=>{_0x3a4f0f[_0x5819('0x1e')](_0x2b5144);})['catch'](_0x1728fb=>{console[_0x5819('0xf')](_0x5819('0x11'),_0x1728fb);});_0x313175=null;}else{_0x3a4f0f['send'](_0x5f067c);}}});}catch(_0x3ad73a){console[_0x5819('0xf')]('handleDNSQuery\x20have\x20exception,\x20error:\x20'+_0x3ad73a['message']);}}function safeCloseWebSocket(_0x150344){try{if(_0x150344[_0x5819('0x0')]===WS_READY_STATE_OPEN||_0x150344[_0x5819('0x0')]===WS_READY_STATE_CLOSING){_0x150344['close']();}}catch(_0x135804){console[_0x5819('0xf')](_0x5819('0x19'),_0x135804);}}
